# javascript之闭包

## 闭包的概念

```
闭包（closure）是 JavaScript 的一种语法特性。

关于闭包，有一种经典的提法——“闭包是代码块和创建该代码块的上下文（环境）中数据的结合”。

闭包就是在函数内部定义函数，内部的函数可访问其外部函数的作用域。下面是在程序中实现闭包的例子。
```

> ```js
> function outer(name){ // 外部的函数
>  var msg="hello";
>  function inner(){ // 内部函数
>    alert(msg+" "+name);
>   }
>  return inner(); // 返回内部函数
> }
> var clos=outer("WANGERN");
> clos();
> ```

```
执行代码，将弹出警告“hello WANGERN”。
```

## 前提

要理解闭包，还有一个很关键性概念—— JavaScript 的作用域规则。先解释一下作用域（scope）。在运行函数都会创建属于函数的上下文环境（context）及作用域，作用域即当前环境范围内的变量。JavaScript 中最外围的环境为 window 对象，也就是全局作用域所在的环境。当执行到下一级环境时，下一级环境会主动包含上一级的作用域，最终形成一级一级关联的作用域链（对象的 \[\[Scope\]\] 属性指向该作用域链）。当有下一级环境生成时，上一级环境会失活，但不会自动销毁而保存在一种“栈”式结构中，这样可以保证作用域链的延续性，也可以环境回退时再次激活。当前环境可访问当前作用域链中的全部变量，比如上面代码中的 inner\(\) 函数可访问 outer\(\) 函数中的 msg 和 name 变量。

闭包就是借助这种作用域链，一方面可使内部函数可访问外部函数的变量；另一方面，闭包还可以抑制外部函数环境的销毁，使其变量始终保存在内存中，直至不需要时再销毁。

## 闭包的实例

       先看下面的例子，当function里嵌套function时，内部的function可以访问外部function里的变量。

```js
function foo(x) {
    var tmp = 3;
    function bar(y) {
        alert(x + y + (++tmp));
    }
    bar(10);
}
foo(2)
```



